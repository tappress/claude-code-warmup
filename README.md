# ⚡ Claude Code Warmup

> Automatically warm up your Claude Code rate limit window so it resets right before your work session.

---

## The Problem

Claude Code's rate limits work on a **rolling 5-hour window** — the clock starts from your **first request**, not midnight. So if you sleep in and start at noon, you get a short window for the day.

**Solution:** Send a tiny warm-up message a few hours before you plan to work. The 5-hour window starts then, resets before you begin, and you get full quota.

---

## How It Works

1. A **Vercel cron job** fires at your configured time (e.g. 06:00 UTC)
2. It exchanges your `CLAUDE_REFRESH_TOKEN` for a fresh OAuth access token
3. Sends a short message to Claude via the Anthropic API
4. Your 5-hour window starts ticking → resets before your workday begins ✅

---

## One-Click Deploy

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/your-username/claude-code-warmup)

---

## Setup (Manual)

### 1. Fork & Clone

```bash
git clone https://github.com/tappress/claude-code-warmup
cd claude-code-warmup
```

### 2. Set the Cron Schedule

Edit `vercel.json` and change the `schedule` to fire 3–4 hours before your usual start time (**UTC**):

```json
{
  "crons": [
    {
      "path": "/api/warmup",
      "schedule": "0 6 * * *"
    }
  ]
}
```

> **Tip:** Use [crontab.guru](https://crontab.guru) to build your expression.
> Vercel free tier supports daily crons. Pro tier supports up to hourly.

### 3. Get Your Refresh Token

Your Claude Code OAuth refresh token is stored locally after you log in:

```bash
cat ~/.claude/.credentials.json | python3 -c "import sys,json; print(json.load(sys.stdin)['claudeAiOauth']['refreshToken'])"
```

Copy the value (starts with `sk-ant-ort01-...`).

### 4. Create a Vercel KV Store

Vercel KV is **required** — it persists the refresh token across cron runs and automatically stores rotated tokens so the chain never breaks.

1. In your Vercel project → **Storage** → **Create KV Database**
2. Click **Connect** to link it to your project — Vercel will auto-add `KV_REST_API_URL` and `KV_REST_API_TOKEN` env vars

### 5. Import into Vercel

1. Go to [vercel.com/new](https://vercel.com/new) → Import your forked repo
2. In **Environment Variables**, add:

| Variable | Value |
|---|---|
| `CLAUDE_REFRESH_TOKEN` | `sk-ant-ort01-...` (seed/initial refresh token) |
| `WARMUP_MESSAGE` | *(optional)* Custom message |
| `KV_REST_API_URL` | *(auto-added if KV store linked)* |
| `KV_REST_API_TOKEN` | *(auto-added if KV store linked)* |

3. Deploy!


## Environment Variables

| Variable | Required | Default | Description |
|---|---|---|---|
| `CLAUDE_REFRESH_TOKEN` | ✅ | — | OAuth refresh token (seed) from `~/.claude/.credentials.json` |
| `WARMUP_MESSAGE` | ❌ | *"Hello! This is an automated warm-up..."* | Custom message sent to Claude |
| `CRON_SECRET` | ✅ | *auto (Vercel)* | Auto-generated by Vercel — locks endpoint to cron only |
| `KV_REST_API_URL` | ✅ | *auto (Vercel KV)* | Auto-added when KV store is linked |
| `KV_REST_API_TOKEN` | ✅ | *auto (Vercel KV)* | Auto-added when KV store is linked |

---

## Local Development

```bash
npm install
cp .env.example .env.local
# Fill in CLAUDE_REFRESH_TOKEN in .env.local

npx vercel dev
# Then open http://localhost:3000 or curl http://localhost:3000/api/warmup
```

---

## How the Auth Works

Claude Code uses standard OAuth 2.0. Your refresh token (stored in `~/.claude/.credentials.json`) is exchanged for a short-lived access token each time the cron runs.

---

## License

MIT
